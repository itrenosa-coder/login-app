<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login / Registro</title>

<style>
/* ================== GLOBAL ================== */
html, body {
  width: 100%;
  height: 100%;
  margin: 0;
  padding: 0;
  font-family: Arial, sans-serif;
  background: #FFFFFF;
  /* Reglas para bloquear el scroll de la página */
  overflow: hidden;
  position: fixed; 
}

body {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 100%;
  height: 100%;
}

/* Animación de fondo */
@keyframes rotate {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.container {
  width: 90%;
  max-width: 380px;
  padding: 40px;
  border-radius: 15px;
  box-shadow: 0 6px 15px rgba(0,0,0,0.2);
  position: relative;
  z-index: 1;
  box-sizing: border-box;
  /* CAMBIO: Por defecto, el contenedor NO tiene scroll */
  overflow-y: hidden;
}

/* NUEVA CLASE: Esta clase activará el scroll cuando sea necesario */
.container.scrollable {
  overflow-y: auto;
}

.container::before {
  content: '';
  position: absolute;
  z-index: -2;
  left: -50%;
  top: -50%;
  width: 200%;
  height: 200%;
  background: conic-gradient(from 90deg, #4285F4, #DB4437, #F4B400, #0F9D58, #4285F4);
  animation: rotate 4s linear infinite;
}

.container::after {
  content: '';
  position: absolute;
  z-index: -1;
  inset: 4.5px;
  border-radius: 12px;
  background: white;
}

h2 {
  text-align: center;
  margin-bottom: 20px;
  color: #333;
  font-size: 24px;
}

input, select {
  width: 100%;
  padding: 12px;
  margin: 10px 0;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 16px;
  box-sizing: border-box;
}

button {
  width: 100%;
  padding: 14px;
  margin-top: 15px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 17px;
  color: white;
  transition: 0.3s;
}

#loginBtn { background: #4CAF50; }
#registroBtn { background: #2196F3; }
button:hover { opacity: 0.9; }

.link {
  text-align: center;
  margin-top: 20px;
}
.link a {
  cursor: pointer;
  text-decoration: none;
  font-weight: bold;
  font-size: 15px;
}
.link a.loginLink { color: #4CAF50; }
.link a.registroLink { color: #2196F3; }

.msg {
  text-align: center;
  margin-top: 10px;
  display: none;
  padding: 8px;
  border-radius: 6px;
  font-size: 14px;
}
.success { background: #e0f7e9; color: #2e7d32; }
.error { background: #fdecea; color: #c62828; }

/* ================== CELULARES (<480px) ================== */
@media (max-width: 480px) {
  body {
    align-items: center;
    justify-content: center;
    padding: 0;
    overflow: hidden;
  }

  .container {
    width: 90vw !important;
    height: auto !important;
    max-height: 95vh;
    border-radius: 15px;
    padding: 30px;
    box-sizing: border-box;
  }

  h2 { font-size: 24px; margin-bottom: 20px; }
  input, select { padding: 15px; font-size: 16px; margin: 10px 0; }
  button { padding: 15px; font-size: 18px; margin-top: 15px; }
  .link a { font-size: 16px; }
}

/* ================== TABLETAS (481px - 768px) ================== */
@media (min-width: 481px) and (max-width: 768px) {
  .container {
    max-width: 450px;
  }
}
</style>

</head>
<body>
  <div class="container">
    <!-- El HTML del login y registro no cambia -->
    <div id="loginDiv">
      <h2>Login</h2>
      <input type="text" id="loginUsuario" placeholder="Usuario">
      <input type="password" id="loginPassword" placeholder="Contraseña">
      <select id="loginRol">
        <option value="Usuario">Usuario Estándar</option>
        <option value="Admin">Administrador</option>
      </select>
      <button id="loginBtn">Login</button>
      <div class="link">
        <a class="registroLink" onclick="mostrarRegistro()">¿No tienes cuenta? Registrarse</a>
      </div>
      <div id="loginMsg" class="msg error"></div>
    </div>
    <div id="registroDiv" style="display:none;">
      <h2>Registro</h2>
      <input type="text" id="regUsuario" placeholder="Usuario">
      <input type="email" id="regEmail" placeholder="Email">
      <input type="password" id="regPassword" placeholder="Contraseña">
      <button id="registroBtn">Registrar</button>
      <div class="link">
        <a class="loginLink" onclick="volverLogin()">Volver al Login</a>
      </div>
      <div id="registroMsg" class="msg"></div>
    </div>
  </div>

  <script>
    // =================================================================
    // CONFIGURACIÓN
    // =================================================================
    // ¡No olvides poner tu URL de la Web App de Google aquí!
    const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzdioqwBE9kYtrFZeaneMl4RW38emUaw-ECl5d79LY5o2U9CL2O5IFcAR4UCRu_HmkL/exec';


    // =================================================================
    // REFERENCIAS A ELEMENTOS DEL DOM
    // =================================================================
    const container = document.querySelector('.container');
    const loginDiv = document.getElementById('loginDiv');
    const registroDiv = document.getElementById('registroDiv');
    const loginBtn = document.getElementById('loginBtn');
    const registroBtn = document.getElementById('registroBtn');
    const loginMsg = document.getElementById('loginMsg');
    const registroMsg = document.getElementById('registroMsg');
    const inputs = document.querySelectorAll('input, select');

    
    // =================================================================
    // LÓGICA DE NAVEGACIÓN (Mostrar/Ocultar Vistas)
    // =================================================================
    function mostrarRegistro() {
      loginDiv.style.display = 'none';
      registroDiv.style.display = 'block';
      limpiarMensajes();
    }

    function volverLogin() {
      loginDiv.style.display = 'block';
      registroDiv.style.display = 'none';
      limpiarMensajes();
    }

    function limpiarMensajes(){
      loginMsg.style.display = "none";
      registroMsg.style.display = "none";
    }

    
    // =================================================================
    // LÓGICA DE API (Comunicación con Google Apps Script)
    // =================================================================
    async function callGasApi(action, payload) {
      const response = await fetch(GAS_WEB_APP_URL, {
        method: 'POST',
        mode: 'cors',
        headers: {
          'Content-Type': 'text/plain;charset=utf-8',
        },
        body: JSON.stringify({ action, payload }),
      });
      if (!response.ok) {
        throw new Error('Error de red o del servidor.');
      }
      return response.text().then(text => JSON.parse(text));
    }


    // =================================================================
    // MANEJADORES DE EVENTOS (Clicks en Botones)
    // =================================================================
    loginBtn.addEventListener('click', async () => {
      const usuario = document.getElementById('loginUsuario').value;
      const password = document.getElementById('loginPassword').value;
      const rol = document.getElementById('loginRol').value;
      
      loginBtn.disabled = true;
      loginBtn.innerText = "Validando...";
      
      try {
        const resp = await callGasApi('login', { usuario, password, rol });
        if (resp.success) {
          window.top.location.href = resp.url;
        } else {
          loginMsg.innerText = resp.msg;
          loginMsg.className = "msg error";
          loginMsg.style.display = "block";
          setTimeout(() => loginMsg.style.display = "none", 4000);
        }
      } catch (err) {
        alert("Error de comunicación con el servidor: " + err.message);
      } finally {
        loginBtn.disabled = false;
        loginBtn.innerText = "Login";
      }
    });

    registroBtn.addEventListener('click', async () => {
      const usuario = document.getElementById('regUsuario').value;
      const email = document.getElementById('regEmail').value;
      const password = document.getElementById('regPassword').value;
      
      registroBtn.disabled = true;
      registroBtn.innerText = "Registrando...";
      
      try {
        const resp = await callGasApi('register', { usuario, email, password });
        registroMsg.innerText = resp.msg;
        registroMsg.style.display = "block";
        if (resp.success) {
          registroMsg.className = "msg success";
          setTimeout(volverLogin, resp.duration || 6000);
        } else {
          registroMsg.className = "msg error";
          setTimeout(() => registroMsg.style.display = "none", 4000);
        }
      } catch (err) {
        alert("Error de comunicación con el servidor: " + err.message);
      } finally {
        registroBtn.disabled = false;
        registroBtn.innerText = "Registrar";
      }
    });


    // =================================================================
    // MANEJO DINÁMICO DEL SCROLL (Para el teclado del móvil)
    // =================================================================
    inputs.forEach(input => {
      input.addEventListener('focus', () => {
        container.classList.add('scrollable');
      });

      input.addEventListener('blur', () => {
        container.classList.remove('scrollable');
        container.scrollTop = 0;
      });
    });
  </script>
</body>
</html>
